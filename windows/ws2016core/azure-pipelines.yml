trigger:
  branches:
    include:
      - master
  paths:
    include:
      - windows/build.ps1
      - windows/iso.pkr.hcl
      - windows/ws2016core/*
      - windows/scripts/change-pass.ps1
      - windows/scripts/enable-rdp.ps1
      - windows/scripts/enable-winrm.ps1
      - windows/scripts/install-vm-tools.ps1
      - windows/scripts/undo-winrmconfig.ps1

jobs:
- job: Default
  timeoutInMinutes: 120
  pool:
    name: Lab
  variables:
    - group: packer
    - group: vcenter
  steps:
  - script: pwsh ./build.ps1 -Type iso -Image ws2016core
    workingDirectory: $(Build.SourcesDirectory)/windows
    displayName: 'Build Windows Server 2016 Core packer image'
    env:
      VSPHERE_USER: $(vcenter.username)
      VSPHERE_PASS: $(vcenter.password)
      ADMIN_PASS: $(packer.admin.password)